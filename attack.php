<?php  require_once('eng/sec/session.php');  require_once('lib/form.php');  require_once('eng/conn/pm.php');  require_once('eng/main/account.php');  require_once('eng/main/plus.php');  require_once('lib/defines.php');  require_once('lib/utility.php');  require_once('eng/main/hero.php');  require_once('eng/main/union.php');  require_once('lib/dbo.php');  require_once('eng/main/validation.php');  function ShowForm($disabled)  {   global $lang;   global $town;   echo '<div><form action="attack.php" method="post">';   $_POST['com'] = SEND;   foreach($_POST as $key=>$value)    printf('<input type="hidden" name="%s" value="%s" />',$key,$value);   if($_POST['kind'] == A_ATTACK and $_POST['t8'])   {    printf('<table class="tableVal1"><tr><td>%s</td></tr><tr><td>%s</td></tr>',$lang['Cata'],$lang['Building']);    printf('<tr><td><select name="tar"><option value="0" selected="selected" >%s</option>',$lang['Random']);    $lvl = $town->GetLevel(19);    if($lvl > 10)    {     for($i = 1; $i<6;$i++)      printf('<option value="%s">%s</option>',$i,$lang['b'.$i]);    }    if($lvl > 15)    {     for($i = 6; $i<33;$i++)      printf('<option value="%s">%s</option>',$i,$lang['b'.$i]);    }    echo '</select></td></tr></table>';   }   printf('<div class="sendButt"><input type="submit" value="%s" %s /> </div></form></div>',$lang['Send'],$disabled ? 'disabled="disabled"' : '');  }  if(!$session->IsLoad() or $session->GetType() != LOG)   $session->Href('index.php');     $account = new Account($session->aid,true);  if(!$account->IsLoad())   $session->Href('index.php');    $account->UpdateTown($_SERVER['REQUEST_TIME']);  if(!$account->ac)      $session->Href('index.php');     $plus = $account->GetPlus();  $hero = $account->GetHero();  $town = $account->GetDefaultTown();  $pm = new PM($session->aid);  $union = new Union($account->uid);  define('SELECT_TROOP','st');  define('VALIDATION', 'va');  define('SEND', 'send');  if($town->GetLevel(19) == -1)   $session->Href('town.php');  if(isset($_POST['com']) and $_POST['com'] == SEND )  {   if($town->Lock())   {    if($town->modify == $_SERVER['REQUEST_TIME'])    {     $Validation->Start();     $arr = array();     $brr = array();     if(!$Validation->disabled)     {      $arr['kind'] = $_POST['kind'];      $arr['pid1'] = $account->id;      $arr['tid1'] = $town->id;      $arr['mid1'] = $town->mid;      $arr['pid2'] = $Validation->_info['pid'];      $arr['tid2'] = $Validation->_info['tid'];      $arr['mid2'] = $Validation->_info['mid'];      $arr['cid'] = $Validation->_info['cid'];      for($i = 1; $i<15;$i++)      {       $t = 't'.$i;       $arr[$t] = $_POST[$t];       $brr[$t] = $town->$t - $arr[$t];      }      if(($_POST['kind'] == A_SUPPORT and ($arr['pid1'] != $arr['pid2'])) or ($_POST['kind'] == A_BLOCKADE))      {       $_POST['h'] = 0;      }      $arr['h'] = $_POST['h'];      if($arr['h'])      {       $brr['h'] = '0';      }      if($_POST['e1'])      {       if($_POST['e1'] == ELIXIR_COMBIN)       {        $brr['e15'] = $town->e15 - $_POST['en1'];        $t = 'e'.$_POST['e2'];        $brr[$t] = $town->$t - $_POST['en2'];        $t = 'e'.$_POST['e3'];        $brr[$t] = $town->$t - $_POST['en3'];        $arr['e1'] = $_POST['e2'];        $arr['e2'] = $_POST['e3'];        $arr['ne1'] = $_POST['en2'];        $arr['ne2'] = $_POST['en3'];       }       elseif($_POST['e1'])       {        $t = 'e'.$_POST['e1'];        $brr[$t] = $town->$t - $_POST['en1'];        $arr['e1'] = $_POST['e1'];              $arr['ne1'] = $_POST['en1'];       }      }                  if(isset($_POST['tar']) and $_POST['tar'] < 33)                      $arr['tar'] = $_POST['tar'];      $arr['len'] = $Validation->_distance;      $arr['modify'] = $_SERVER['REQUEST_TIME'] + $Validation->_distance;                  if($arr['kind'] == A_MERGER)                  {                      if($account->Lock())                      {                          if($plus->Merge())                          {                              $dbo->UpdateRow(DB_PERFIX.'town',$brr,$town->id);                              $dbo->InsertRow(DB_PERFIX.'troop_s',$arr);                          }                      }                      $account->UnLock();                  }                  else                  {                      $dbo->UpdateRow(DB_PERFIX.'town',$brr,$town->id);                      $dbo->InsertRow(DB_PERFIX.'troop_s',$arr);                  }     }    }   }   $town->UnLock();   $session->Href('building.php?id=19');  }  $form->Header(array('attack'),array('attack'));  $session->FreeMemory();  $show = SELECT_TROOP;  if(isset($_POST['com']) and $_POST['com'] == SELECT_TROOP)   $show = VALIDATION;  ?>
<div class="h56">
<img src="img/m0.png"  />
</div>
<div class="attackL">
<?php  if($show == SELECT_TROOP)   require_once('temp/attack/select_troop.php');  else  {   $Validation->Start();   require_once('temp/attack/validation_p.php');  }  ?>
</div>
<div class="h56">
<img src="img/m2.png"  />
</div>
<?php  $form->Footer();  $session->Save();  ?>