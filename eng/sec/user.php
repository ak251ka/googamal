<?php  require_once('lib/dbo.php');  require_once('lib/object.php');  class User extends Object  {   protected $_nError;   public function GetError()   {    return $this->_nError;   }   public function Find($name)   {    global $dbo;    $name = $dbo->EscapeString($name);    return (int)$dbo->ExectueScaler(sprintf('SELECT `id` FROM `%saccount` WHERE `name` = \'%s\' LIMIT 1',     DB_PERFIX,$name) , 'id');   }   public function MatchPassword($id, $pass)   {    global $dbo;    return (int)$dbo->ExectueScaler(sprintf('SELECT `id` FROM `%saccount` WHERE `id` = \'%d\' AND `password` = \'%s\' LIMIT 1',     DB_PERFIX,$id, sha1($pass)) , 'id');   }   protected function GetSitter($id)   {    global $dbo;    return $dbo->ExectueRow(sprintf('SELECT `sitter1`, `sitter2` FROM `%saccount` WHERE `id` = \'%d\'',DB_PERFIX, $id));   }   public function Load($name, $pass)   {    global $dbo;    $this->_nError = NO_ERROR;    $this->_data = array();    $id = $this->Find($name);    if($id)    {     if($this->MatchPassword($id, $pass))     {      $this->_nError = NO_ERROR;      $this->_data['aid'] = $id;      $this->_data['pid'] = $id;      return true;     }     $arr = $this->GetSitter($id);     if((int)$arr['sitter1'] > 0 and $this->MatchPassword($arr['sitter1'],$pass))     {      $this->_nError = NO_ERROR;      $this->_data['aid'] = $id;      $this->_data['pid'] = $arr['sitter1'];      return true;     }     if((int)$arr['sitter2'] > 0 and $this->MatchPassword($arr['sitter2'],$pass))     {      $this->_nError = NO_ERROR;      $this->_data['aid'] = $id;      $this->_data['pid'] = $arr['sitter2'];      return true;     }     $this->_nError = E_PASSWORD;     return false;    }    $this->_nError = E_USER_NOT_FIND;    return false;   }   public function GetName($id)   {    global $dbo;    return $dbo->ExectueScaler(sprintf('SELECT `name` FROM `%saccount` WHERE `id` = \'%d\'',DB_PERFIX, $id),'name');   }   public function UnderProtection($pid)   {    if($pid == 0)     return false;    global $dbo;    return $dbo->ExectueScaler(sprintf('SELECT COUNT(*) AS `c` FROM `%saccount` WHERE `id` = \'%s\' AND `protected` >= \'%d\'',     DB_PERFIX, $pid, $_SERVER['REQUEST_TIME']),'c');   }  }  $user = new User;  ?>