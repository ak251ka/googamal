<?php  require_once('lib/config.php');  require_once('lib/dbo.php');  require_once('lib/utility.php');  require_once('lib/object.php');  class LogManager extends Object  {   public function Load()   {    global $dbo;    $this->_data = $dbo->ExectueRow(sprintf('SELECT * FROM `%slogin` WHERE `code` = \'%s\'',DB_PERFIX, $_SESSION['CODE']));    return $this->IsLoad();   }      public function Create($pid, $sitter)   {    global $dbo;    $this->_data['pid'] = $pid;    $this->_data['code'] = $_SESSION['CODE'];    $this->_data['sitter'] = $sitter;    $this->_data['online'] = 1;    $this->_data['modify'] = strtotime(date('Y-m-d H:00:00'));    $dbo->InsertRow(sprintf('%slogin', DB_PERFIX),  $this->_data);    $this->_data['id'] = $dbo->InsertedID();   }      public function Save()   {    if(!$this->IsLoad())     return;    $online = ($_SERVER['REQUEST_TIME'] - $this->_data['modify'])/ONE_HOUR;    if($online)    {     $this->_data['online'] = (int)$this->_data['online'] + (int)$online;     $this->_data['modify'] =  strtotime(date('Y-m-d H:00:00'));    }    global $dbo;    $dbo->UpdateRow(sprintf('%slogin',DB_PERFIX),$this->_data, $this->_data['id']);      $dbo->ExectueQuery(    sprintf(    'INSERT INTO `%sips`(`pid`, `ip`, `modify`) VALUES (\'%s\',\'%u\',\'%s\') ON DUPLICATE KEY UPDATE `modify` = \'%s\'',     DB_PERFIX, $this->_data['pid'],ip2long($_SERVER['REMOTE_ADDR']),     $_SERVER['REQUEST_TIME'],$_SERVER['REQUEST_TIME']));   }  }  $logManager = new LogManager;  ?>