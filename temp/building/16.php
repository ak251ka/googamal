<div class="b_troop">
<?php  require_once('.//lib/form.php');  require_once('.//lib/dbo.php');  require_once('.//eng/main/troop.php');  if($town->$u == 0)  {   echo $lang['BuildBuilding'].'</div>';   return;  }  $sql = $dbo->ExectueQuery(sprintf('SELECT * FROM `%stroop_info` WHERE `kind` = \'%s\' ORDER BY `id` LIMIT 7,3',DB_PERFIX,$account->kind));  $i = 0;  $list = array();  while($row = $dbo->Read($sql))  {   $row['times'] = round($row['times'] *(ONE_TICK/ONE_HOUR));   $list[$i++] = new Object($row);   $form->AddModal('mo'.$i,$row['name'],sprintf('<img src="img/troop/b/%d_%d.gif" class="bigimg" alt="%s"/>%s',    $account->kind,$i+7,$row['name'],$row['desc']),$form->TroopInfo(    $row['r1'],$row['r2'],$row['r3'],$row['r4'],$row['r5'],    SecToString($row['times']),$troops[$account->kind][$i + 7][8],    $troops[$account->kind][$i + 7][0],$troops[$account->kind][$i + 7][1],$troops[$account->kind][$i + 7][2],    $troops[$account->kind][$i + 7][3],$troops[$account->kind][$i + 7][4],$troops[$account->kind][$i + 7][5]));  }  $hitem = $hero->GetItems();  $bph = 0;  if(isset($hitem[1]))  {   if($hitem[1]->t2 == 5)    $bph = $hitem[1]->t3 * SPACIAL_HERO_ITEM_TRAIN;  }  $dbo->Cancel($sql);  $bph += $town->$u * 2;  $bph /= 100;  if(isset($_POST['com']) and $_POST['com'] == TERAIN_TROOP)  {   $_POST['tbT1'] = isset($_POST['tbT1'])? ValidNumber($_POST['tbT1'],true): 0;   if(!($town->res_u & 128))    $_POST['tbT1'] = 0;   $t = MaxTrain($list[0]);   if($_POST['tbT1'] and $_POST['tbT1'] > $t)    $_POST['tbT1'] = $t;    if($_POST['tbT1'])    $town->TrainTroop( 16, 8, $list[0]->times - ($list[0]->times * $bph), $_POST['tbT1'],      $list[0]->r1,$list[0]->r2,$list[0]->r3,$list[0]->r4,$list[0]->r5, $troops[$account->kind][8][8]);        $_POST['tbT2'] = isset($_POST['tbT2'])? ValidNumber($_POST['tbT2'],true): 0;   if(!($town->res_u & 256))    $_POST['tbT2'] = 0;   $t = MaxTrain($list[1]);   if($_POST['tbT2'] and $_POST['tbT2'] > $t)    $_POST['tbT2'] = $t;      if($_POST['tbT2'])    $town->TrainTroop( 16, 9, $list[1]->times - ($list[1]->times * $bph), $_POST['tbT2'],      $list[1]->r1,$list[1]->r2,$list[1]->r3,$list[1]->r4,$list[1]->r5, $troops[$account->kind][9][8]);      $_POST['tbT3'] = isset($_POST['tbT3'])? ValidNumber($_POST['tbT3'],true): 0;   if(!($town->res_u & 512))    $_POST['tbT3'] = 0;   $t = MaxTrain($list[2]);   if($_POST['tbT3'] and $_POST['tbT3'] > $t)    $_POST['tbT3'] = $t;   if($town->Lock())   {    if($_POST['tbT3'])     $town->TrainTroop( 16, 10, $list[2]->times - ($list[2]->times * $bph), $_POST['tbT3'],       $list[2]->r1,$list[2]->r2,$list[2]->r3,$list[2]->r4,$list[2]->r5, $troops[$account->kind][10][8]);   }   $town->UnLock();  }  ?>
<form action="<?php printf('building.php?bid=%s&amp;tid=%s',$bid,$town->id);?>" method="post">
<input type="hidden" name="com" value="<?php echo TERAIN_TROOP;?>"  />
<table>
<tr><td><?php echo $lang['Troops'];?></td><td><?php echo $lang['Cost'];?></td><td><?php echo $lang['CurrentT'];?></td><td colspan="2"><?php echo $lang['Number'];?></td><td><?php echo $lang['Action'];?></td></tr>

<tr><td><img src="img/troop/s/<?php echo $account->kind;?>_8.gif" class = "i30s" onclick="modal.Show('mo1');" alt = "<?php echo $list[0]->name;?>"/></td>
<?php  if(!($town->res_u & 128))   printf('<td colspan="5">%s</td>',sprintf($lang['NoResearchT'],$list[0]->name));  else  {  ?>
<td><?php $form->EchoCost($list[0]->r1,$list[0]->r2,$list[0]->r3,$list[0]->r4,$list[0]->r5,SecToString($list[0]->times - ceil($list[0]->times * $bph)),$troops[$account->kind][8][8]); ?></td><td><?php echo $town->t8;?></td><td><?php  printf('<a href="javascript:void(0);" onclick="SetValues(\'tbT1\',this.innerHTML);">%s</a>',MaxTrain($list[0]));  ?></td><td><input type="text" value="0" name="tbT1" id="tbT1"  /></td><td><input type="submit" value="<?php echo $lang['Training'];?>" /></td>
<?php  }?></tr>
<tr><td><img src="img/troop/s/<?php echo $account->kind;?>_9.gif" class = "i30s" onclick="modal.Show('mo2');" alt = "<?php echo $list[1]->name;?>"/></td>
<?php  if(!($town->res_u & 256))   printf('<td colspan="5">%s</td>',sprintf($lang['NoResearchT'],$list[1]->name));  else  {  ?>
<td><?php $form->EchoCost($list[1]->r1,$list[1]->r2,$list[1]->r3,$list[1]->r4,$list[1]->r5,SecToString($list[1]->times - ceil($list[1]->times * $bph)), $troops[$account->kind][9][8]); ?></td><td><?php echo $town->t9;?></td><td><?php  printf('<a href="javascript:void(0);" onclick="SetValues(\'tbT2\',this.innerHTML);">%s</a>',MaxTrain($list[1]));  ?></td><td><input type="text" value="0" name="tbT2" id="tbT2"  /></td><td><input type="submit" value="<?php echo $lang['Training'];?>" /></td>
<?php  }?></tr>
<tr><td><img src="img/troop/s/<?php echo $account->kind;?>_10.gif" class = "i30s" onclick="modal.Show('mo3');" alt = "<?php echo $list[2]->name;?>"/></td>
<?php  if(!($town->res_u & 512))   printf('<td colspan="5">%s</td>',sprintf($lang['NoResearchT'],$list[2]->name));  else  {  ?>
<td><?php $form->EchoCost($list[2]->r1,$list[2]->r2,$list[2]->r3,$list[2]->r4,$list[2]->r5,SecToString($list[2]->times - ceil($list[2]->times * $bph)), $troops[$account->kind][10][8]); ?></td><td><?php echo $town->t10;?></td><td><?php  printf('<a href="javascript:void(0);" onclick="SetValues(\'tbT3\',this.innerHTML);">%s</a>',MaxTrain($list[2]));  ?></td><td><input type="text" value="0" name="tbT3" id="tbT3"  /></td><td><input type="submit" value="<?php echo $lang['Training'];?>" /></td>
<?php  }?></tr>
</table>
</form>

<table>
<tr><td class="center"  colspan="6"><?php echo $lang['TrainingTroop'];?></td></tr>
<tr><td><?php echo $lang['Troops'];?></td><td><?php echo $lang['Number'];?></td><td colspan="2"><?php echo $lang['TimeProcess'];?></td><td><?php echo $lang['EndTime'];?></td><td><?php echo $lang['InDate'];?></td></tr>
<?php  $sql = $dbo->ExectueQuery(sprintf('SELECT * FROM `%stroop_t` WHERE `tid` = \'%s\' AND  `bid` = \'16\' AND `d` = \'0\' ORDER BY `end`',   DB_PERFIX,$town->id));    if(!$dbo->RowsNumber($sql))   printf('<tr><td class="center"  colspan="6">%s</td></tr>',$lang['NoRecord']);  else  {   $i = 0;   while($row = $dbo->Read($sql))   {    $start = $row['start'];    $end = $row['end'];    $modify = $town->modify;    $last = 0;    if($start > $_SERVER['REQUEST_TIME'])    {     $num = (int)floor(($end - $start)/$row['et']);     $last = ($start - $_SERVER['REQUEST_TIME']) + $row['et'];    }    else    {     if($end > time())     {      $num = (int)floor(($end - $_SERVER['REQUEST_TIME'])/$row['et']);      $last = ($end - $_SERVER['REQUEST_TIME']) - $num *$row['et'];      $num++;     }     else     {      $num = $last = 0;     }    }    $tt = $row['tt'] - 7;     printf('<tr><td><img src="img/troop/s/%s_%s.gif" class = "i30s" onclick="modal.Show(\'mo%s\');" alt = "%s"/></td><td id ="ttp%sn">%s</td><td id ="ttp%sl">%s</td><td class="ttrain" id ="ttp%d">%s</td><td style="min-width:80px;">%s</td><td>%s</td></tr>',    $account->kind,$row['tt'],$tt,$list[$tt - 1]->name,$i,$num,$i,SecToString($row['et']),$i,SecToString($last),    Until($end,'ttimer'.$i),DateToString($end));    $i++;   }  }  $dbo->Cancel($sql);  ?>
</table>
</div>