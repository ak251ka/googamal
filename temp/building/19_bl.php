<?php  require_once('.//lib/config.php');  require_once('.//lib/dbo.php');  require_once('.//lib/defines.php');  require_once('.//eng/main/troop.php');  $count = $dbo->ExectueScaler(      sprintf('SELECT COUNT(*) AS `c` FROM `%stroop_b` WHERE `mid` = \'%s\' AND `d` = \'0\'',          DB_PERFIX,$town->mid),'c');  $p = isset($_GET['page']) ? ValidNumber($_GET['page'],true) : 0;  $r = isset($_GET['row']) ? ValidNumber($_GET['row'],true) : 30;  if($p * $r > $count)      $p = 0;  $sql = $dbo->ExectueQuery(sprintf('SELECT `b`.*,`a`.`kind` AS `kind`,`a`.`name` AS `aname`, `t`.`name` AS `tname` FROM `%1$stroop_b` AS `b` LEFT JOIN `%1$stown` AS `t` ON(`b`.`tid1` = `t`.`id`) LEFT JOIN `%1$saccount` AS `a` ON (`b`.`pid1` = `a`.`id`) WHERE `b`.`mid` = \'%2$s\' AND `d` = \'0\' LIMIT %d, %d',      DB_PERFIX,$town->mid,$p*$r, $r));  ?>
<?php  function EchoBlockadeTroop($row)  {      global $troops;      global $form;      echo '<table>';      printf('<tr><td colspan="14">%s</td></tr>',$form->PlayerLink($row['pid1'],$row['aname']));      printf('<tr><td colspan="14">%s</td></tr>',$form->PlayerLink($row['tid1'],$row['tname']));      echo '<tr>';      for($i = 1; $i<15;$i++)          printf('<td><img src = "img/troop/s/%s_%s.gif" class="i30" alt = "%s" /></td>',$row['kind'],$i,$troops[$row['kind']][$i][6]);      echo '</tr><tr>';      for($i = 1;$i <15;$i++)          printf('<td>%d</td>',$row['t'.$i]);      echo '</tr>';      echo '</table>';  }  while($row = $dbo->Read($sql))  {      EchoBlockadeTroop($row,true);      gc_collect_cycles();  }    ?>
