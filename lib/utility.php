<?php  require_once('lib/config.php');  require_once('lib/dbo.php');  function Today($timestamp = 0)  {   if(!$timestamp)    $timestamp = $_SERVER['REQUEST_TIME'];   return strtotime(date('Y-m-d 00:00:00', $timestamp));  }  function Dates($timestamp = 0)  {   if($timestamp === 0)    $timestamp = $_SERVER['REQUEST_TIME'];   return date('Y-m-d H:i:s', $timestamp);  }  function NoNumbers($str)  {     return rtrim($str,'0123456789');  }  function SecToDay($sec)  {   return round($sec/(ONE_HOUR*24),1);  }  function Until($timestamp, $id = NULL)  {   global $lang;   $timestamp -= $_SERVER['REQUEST_TIME'];   if($timestamp < -0)   {    if($id)     return sprintf($lang['UntilID'], $id, '00', '00', '00:?');    return sprintf($lang['Until'], '0:?', $lang['Unknown']);   }   if($id)   {    $hour = floor($timestamp/3600);    $timestamp -= $hour * 3600;    $min = floor($timestamp/60);    $timestamp -= $min * 60;    return sprintf($lang['UntilID'], $id, $hour, $min, $timestamp);   }   else   {    if( $timestamp > 86400)     return sprintf($lang['Until'], round($timestamp / 86400,1),$lang['Day']);    elseif($timestamp > 3600)     return sprintf($lang['Until'], round($timestamp / 3600,1), $lang['Hour']);          return sprintf($lang['Until'], round($timestamp,1), $lang['Minute']);   }  }  function dist($x1,$x2,$y1,$y2)  {   return sqrt((pow(($x1 - $x2), 2) + pow(($y1 - $y2), 2)));  }  function Paging($count,$page,$row,$current)  {   $temp = '';   $p = (int)ceil($count/$row);      if($p <=10)   {    for($i =0; $i < $p; $i++)    {     $temp .= ($i == $current)?       sprintf(' <b>%s</b> ',$i + 1):      sprintf(' <b><a href = "%spage=%s&row=%s">%s</a></b> ',$page,$i,$row,$i + 1);    }   }   else   {    $temp = sprintf(' <b><a href = "%spage=%s&row=%s">&rarr;</a></b> ',$page,0,$row);    if($current < 9)    {     for($i = 0;$i< 10;$i++)      $temp .= ($i == $current)?        sprintf(' <b>%s</b> ',$i + 1):       sprintf(' <b><a href = "%spage=%s&row=%s">%s</a></b> ',$page,$i,$row,$i + 1);      if($p > 10)      $temp .= ' &hellip; ';    }    elseif($current + 5 > $p)    {     $temp .= ' &hellip; ';     for($i = $p - 10; $i < $p;$i++)       $temp .= ($i == $current)?        sprintf(' <b>%s</b> ',$i + 1):       sprintf(' <b><a href = "%spage=%s&row=%s">%s</a></b> ',$page,$i,$row,$i+1);    }    else    {     $temp .= ' &hellip; ';     for($i = $current - 4; $i < $current + 4;$i++)      $temp .= ($i == $current)?        sprintf(' <b>%s</b> ',$i + 1):       sprintf(' <b><a href = "%spage=%s&row=%s">%s</a></b> ',$page,$i,$row,$i+1);     $temp .= ' &hellip; ';    }    $temp .= sprintf(' <b><a href = "%spage=%s&row=%s">&larr;</a></b> ',$page,$p - 1,$row);   }   return $temp;  }  function MiladiToShamsi($g_y,$g_m,$g_d)  {   $d_4=$g_y%4;   $g_a=array(0,0,31,59,90,120,151,181,212,243,273,304,334);   $doy_g=$g_a[(int)$g_m]+$g_d;   if($d_4==0 and $g_m>2)    $doy_g++;   $d_33=(int)((($g_y-16)%132)*.0305);   $a=($d_33==3 or $d_33<($d_4-1) or $d_4==0)?286:287;   $b=(($d_33==1 or $d_33==2) and ($d_33==$d_4 or $d_4==1))?78:(($d_33==3 and $d_4==0)?80:79);   if((int)(($g_y-10)/63)==30)   {    $a--;    $b++;   }   if($doy_g>$b)   {    $jy=$g_y-621;    $doy_j=$doy_g-$b;   }   else   {    $jy=$g_y-622;    $doy_j=$doy_g+$a;   }   if($doy_j<187)   {    $jm=(int)(($doy_j-1)/31);     $jd=$doy_j-(31*$jm++);   }   else   {    $jm=(int)(($doy_j-187)/30);     $jd=$doy_j-186-($jm*30);     $jm+=7;   }   return array($jy, $jm, $jd);  }  function DateToString($timestamp)  {   $date = getdate($timestamp);   $day = MiladiToShamsi($date['year'], $date['mon'], $date['mday']);   global $lang;   if($timestamp < Today($_SERVER['REQUEST_TIME']) and $timestamp >= Today($_SERVER['REQUEST_TIME'] - ONE_DAY))    return sprintf('%s %s %s', $lang['Yesterday'],$lang['InHour'],date('H:i',$timestamp));   elseif($timestamp < Today($_SERVER['REQUEST_TIME']+ ONE_DAY) and $timestamp >= Today($_SERVER['REQUEST_TIME']))    return sprintf('%s %s %s', $lang['Today'],$lang['InHour'],date('H:i',$timestamp));   elseif($timestamp < Today($_SERVER['REQUEST_TIME']+ (2 * ONE_DAY)) and $timestamp >= Today($_SERVER['REQUEST_TIME']+ ONE_DAY))    return sprintf('%s %s %s', $lang['Tomorrow'],$lang['InHour'],date('H:i',$timestamp));   elseif((int)date('Y') == $date['year'])    return  sprintf('%d/%d %s %d:%d:%d',$day[1],$day[2], $lang['InHour'],        $date['hours'],$date['minutes'],$date['seconds']);   else    return  sprintf('%d/%d/%d %s %d:%d:%d',$day[0],$day[1],$day[2], $lang['InHour'],        $date['hours'],$date['minutes'],$date['seconds']);  }  function ValidNumber($value,$uint = false)  {   $value =  preg_replace("/[^0-9-]/", "", $value);   $temp = filter_var($value,FILTER_VALIDATE_INT);   if($temp === false)    return 0;   if($uint)    $temp = (int)abs($temp);   return $temp;  }  function Distance($x1, $x2, $y1, $y2, $sp, $point = 0)  {   $dis = sqrt((pow(($x1 - $x2),2) + pow(($y1 - $y2),2)));   $x = ($dis * ONE_TICK) / $sp;   if($x > ONE_TICK and ($point != 0))    $x = ONE_TICK + ((($dis - $sp)*ONE_TICK) / ($sp * $point));   return ceil($x);  }  function SecToString($sec)  {   $h = floor($sec / 3600);   $sec = $sec - ($h*3600);   $m = floor($sec / 60);   $sec = $sec - ($m*60);   return sprintf('%02d:%02d:%02d',$h,$m,$sec);  }  function NegPos($value)  {   return ($value > 0 ? 'p' : 'n').abs($value);  }  function IsBlackName($name)  {   global $dbo;   return $dbo->ExectueScaler(sprintf('SELECT `id` FROM `%sblackname` WHERE `name` = \'%s\'',DB_PERFIX,    $name),'id');  }  function InArmy(&$row)  {   $res = 0;   for($i = 1; $i<12; $i++)    $res += $row['t'.$i];   if(isset($row['t13']))    $res += $row['t13'];   if(isset($row['t14']))    $res += $row['t14'];   if(isset($row['h']))    $res += $row['h'];   return $res;  }  function GUID()  {   return md5( uniqid( mt_rand(), true));  }  function SendMail($message, $to, $subject)  {   $headers =  'MIME-Version: 1.0' . "\r\n".   'Content-type: text/html; charset=utf-8' . "\r\n".   'From:Googamal.ir <noreplay@googamal.ir>' . "\r\n";   mail($to, $subject, $message, $headers);  }  function GetRandom()  {   return mt_rand()/mt_getrandmax();  }  ?>