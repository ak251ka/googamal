<?php  if(!defined('NEW_INCLUDE'))  {   $path = $_SERVER['DOCUMENT_ROOT'];   set_include_path(get_include_path() . PATH_SEPARATOR . $path);   define('NEW_INCLUDE', 1);  }  require_once('lib/defines.php');  require_once('lib/config.php');  require_once('lib/dbo.php');  require_once('eng/sec/session.php');  require_once('eng/forum/topic.php');  require_once('lng/per.php');  $result = '2';  $c = '?';  $id = isset($_GET['id']) ? (int)$_GET['id'] : '0';  if($session->GetType() == LOG and $id)  {   if($session->aid == $session->pid)   {    $tid = $dbo->ExectueScaler(sprintf('SELECT `tid` FROM `%stopic_p` WHERE `id` = \'%s\'',     DB_PERFIX, $id),'tid');    $uid = $dbo->ExectueScaler(sprintf('SELECT `uid` FROM `%stopic` WHERE `id` = \'%s\'',     DB_PERFIX, $tid),'uid');    $topic->Load($uid);    $t = $topic->Topics($tid);    $arr = array('tid' => $tid, 'poid' => $id,'pid' => $session->aid);    if($t->types == INVITED_MEMBER and $topic->IsMember($tid, $session->pid))     $result = 1;    elseif($dbo->ExectueScaler(      sprintf('SELECT COUNT(*) AS `c` FROM `%saccount` WHERE `id` = \'%s\' AND `uid` = \'%s\'',      DB_PERFIX,$session->aid,$uid),'c'))       $result = 1;    if($result)    {     $like = $dbo->ExectueScaler(sprintf('SELECT `id` FROM `%stopic_l` WHERE `poid` = \'%s\' AND `pid` =\'%s\'',      DB_PERFIX, $id, $session->aid),'id');     if($like)     {      $dbo->DeleteRecord(sprintf('%stopic_l',DB_PERFIX),$like);      $result = '0';     }     else     {      $dbo->InsertRow(sprintf('%stopic_l',DB_PERFIX), $arr);      $result = '1';     }    }    $c = $dbo->ExectueScaler(sprintf('SELECT COUNT(*) AS `c` FROM `%stopic_l` WHERE `poid` = \'%s\'',DB_PERFIX,$id),'c');   }   $session->Save();  }  $back = $result.'<br />'.$c.'<br />';  $back .= $result?$lang['Like']:$lang['UnLike'];  echo $back;  ?>